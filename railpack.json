{
  "$schema": "https://schema.railpack.com",
  "provider": "elixir",
  "packages": {
    "elixir": "1.19.2",
    "otp": "28"
  },
  "buildAptPackages": ["git", "curl"],
  "caches": {
    "hex-deps": { "directory": "/root/.hex", "type": "shared" },
    "mix-deps": { "directory": "/root/.cache/mix", "type": "shared" },
    "build-cache": { "directory": "/app/_build", "type": "shared" }
  },
  "steps": {
    "install": {
      "inputs": [
        {
          "local": true,
          "include": ["."],
          "exclude": [".git", "_build", "deps"]
        }
      ],
      "commands": [
        "mix local.hex --force",
        "mix local.rebar --force",
        "mix deps.get --only prod",
        "npm install"
      ],
      "caches": ["hex-deps", "mix-deps"]
    },
    "build": {
      "inputs": [{ "step": "install" }],
      "commands": ["npm run build", "mix assets.deploy", "mix release"],
      "caches": ["build-cache"]
    }
  },
  "deploy": {
    "base": { "step": "build" },
    "inputs": [{ "step": "build" }],
    "startCommand": "/app/_build/prod/rel/railway_app/bin/railway_app eval 'RailwayApp.Release.migrate' && /app/_build/prod/rel/railway_app/bin/railway_app start",
    "variables": {
      "PORT": "4000",
      "PHX_SERVER": "true",
      "MIX_ENV": "prod",
      "SERVICE_NAME": "Incident Response Agent",
      "SERVICE_ICON_URL": "https://tessera.help/logo.svg",
      "HTTP_PROXY_PORT": "4000"
    },
    "paths": ["/app/_build/prod/rel/railway_app/bin"]
  }
}
