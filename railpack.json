{
  "$schema": "https://schema.railpack.com",
  "provider": "docker",
  "buildAptPackages": [
    "git",
    "curl",
    "wget",
    "ca-certificates",
    "gnupg",
    "software-properties-common",
    "build-essential"
  ],
  "caches": {
    "hex-deps": { "directory": "/root/.hex", "type": "shared" },
    "mix-deps": { "directory": "/root/.cache/mix", "type": "shared" },
    "build-cache": { "directory": "/app/_build", "type": "shared" }
  },
  "steps": {
    "install": {
      "commands": [
        "wget -O elixir-install.sh https://build.hex.pm/install.sh",
        "chmod +x elixir-install.sh",
        "./elixir-install.sh -E v1.19.2",
        "mix local.hex --force",
        "mix local.rebar --force",
        "mix deps.get --only prod",
        "npm install"
      ]
    },
    "build": {
      "inputs": [{ "step": "install" }],
      "commands": ["npm run build", "mix assets.deploy", "mix release"]
    }
  },
  "deploy": {
    "base": { "step": "build" },
    "inputs": [{ "step": "build" }],
    "startCommand": "/app/_build/prod/rel/railway_app/bin/railway_app eval 'RailwayApp.Release.migrate' && /app/_build/prod/rel/railway_app/bin/railway_app start",
    "variables": {
      "PORT": "4000",
      "PHX_SERVER": "true",
      "MIX_ENV": "prod"
    },
    "paths": [
      "/root/.mix/escripts",
      "/app/_build/prod/rel/railway_app/bin"
    ]
  }
}
